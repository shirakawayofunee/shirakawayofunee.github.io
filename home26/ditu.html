<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inversa Clone - Vanilla JS Migration</title>

    <!-- 1. 引入 Tailwind CSS (用于复用原有的类名) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. 引入自定义样式 -->
    <style>
        body {
            background: #13140e;
            color: #f4f3e8;
            margin: 0;
            padding: 0;
            /* 防止浏览器默认滚动行为干扰 Lenis */
            overflow-x: hidden;
        }

        /* --- Mask Layer 配置 --- */
        .mask-layer {
            /* 初始 Mask 设置，会被 GSAP 覆盖，但保留此处作为 fallback */
            mask-position: center;
            -webkit-mask-position: center;
            mask-repeat: no-repeat;
            -webkit-mask-repeat: no-repeat;
            /* Mask Image 的路径会在 JS 中动态设置，或者你可以在这里写死 */
        }

        /* --- 动效: 呼吸灯 --- */
        .pulse-hotspots {
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.8;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.02);
            }
        }

        /* --- 动效: 亮度增强 --- */
        .grid-svg,
        .hotspots-svg {
            filter: brightness(150%) drop-shadow(0 0 5px rgba(235, 252, 114, 0.3));
        }

        /* --- 动效: 雨水 --- */
        /* 为了最佳效果，建议 Rain 层使用 background-image 方式，或者保持 img 方式 */
        .rain-overlay {
            pointer-events: none;
            opacity: 0.6;
            mix-blend-mode: screen;
            /* 可选：让雨水融合得更自然 */
        }

        /* 简单的 CSS 平铺动画不可用于 img 标签的 src 滚动，
       除非把图片做成 div 的背景。
       这里为了忠实还原你的 JSX 结构，保持 img 标签，
       主要依靠 GSAP 处理大结构的滚动。
    */

        /* Lenis 推荐的 CSS 设置 */
        html.lenis,
        html.lenis body {
            height: auto;
        }

        .lenis.lenis-smooth {
            scroll-behavior: auto !important;
        }

        .lenis.lenis-smooth [data-lenis-prevent] {
            overscroll-behavior: contain;
        }

        .lenis.lenis-stopped {
            overflow: hidden;
        }

        /* --- GPS / Tech UI 动效 --- */

        /* 自定义雷达扩散动画 (比 Tailwind 默认的 ping 更慢、更大) */
        @keyframes ping-slow {
            0% {
                transform: scale(0.5);
                opacity: 0.8;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .animate-ping-slow {
            animation: ping-slow 3s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        /* 小光点基础样式 */
        .patrol-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #ebfc72;
            /* 默认黄色 */
            box-shadow: 0 0 4px rgba(235, 252, 114, 0.6);
            opacity: 0.8;
            transition: opacity 0.5s;
        }

        /* 红色小光点 (敌人/威胁) */
        .patrol-dot.enemy {
            background-color: #ff4d4d;
            box-shadow: 0 0 4px rgba(255, 77, 77, 0.6);
        }
    </style>
</head>

<body>

    <!-- 
    配置区：
    h-[450vh] 对应原代码中的滚动高度
  -->
    <div id="container" class="home-hero relative h-[450vh] bg-[#13140e]">

        <!-- Sticky Wrapper -->
        <div id="wrapper"
            class="sticky-wrapper sticky top-0 h-screen w-full overflow-hidden flex justify-center items-center">

            <!-- === LAYER 1 (Z=0): 白天 (常驻) === -->
            <div id="day-layer" class="absolute inset-0 w-full h-full z-0">
                <img id="img-day" src="" alt="Day" class="w-full h-full object-cover" />
            </div>

            <!-- === 夹层 (Z=5): 纯色背景 === -->
            <div id="dark-bg-layer"
                class="absolute inset-0 w-full h-full bg-[#13140e] pointer-events-none z-[5] opacity-0"></div>

            <!-- === LAYER 2 (Z=10): 黑夜 + Mask === -->
            <!-- 注意：这里 mask-image 的路径在 JS 中动态赋值 -->
            <div id="night-mask-layer"
                class="mask-layer absolute inset-0 w-full h-full pointer-events-none z-10 opacity-0">
                <!-- 1. 黑夜底图 -->
                <img id="img-night" src="" alt="Night" class="absolute inset-0 w-full h-full object-cover z-0" />

                <!-- 2. Rain 图层 -->
                <div class="absolute inset-0 w-full h-full z-10">
                    <img id="img-rain" src="" alt="Rain" class="rain-overlay w-full h-full object-cover" />
                </div>
            </div>

            <!-- === LAYER 3 (Z=20): Grid & Hotspots === -->
            <div id="tech-layer"
                class="absolute inset-0 w-full h-full pointer-events-none flex items-center justify-center z-20">
                <div id="grid-container" class="relative w-full h-full flex items-center justify-center opacity-0">
                    <img id="img-grid" src="" class="absolute w-[68%] h-auto object-contain grid-svg" alt="Grid" />
<!--                     <img id="img-hotspots" src=""
                        class="absolute w-[60%] h-auto object-contain pulse-hotspots hotspots-svg" alt="Hotspots" /> -->

                    <div id="markers-container" class="absolute inset-0 w-[68%] h-auto aspect-video mx-auto opacity-0">

                        <!-- 1. 动态生成的小光点容器 (由 JS 填充) -->
                        <div id="patrol-dots-layer" class="absolute inset-0 w-full h-full z-0"></div>

                        <!-- 2. 核心大标点：HOTSPOT (红色雷达区) -->
                        <!-- 位置：居中 -->
                        <div
                            class="absolute top-[48%] left-[50%] -translate-x-1/2 -translate-y-1/2 flex items-center z-10">
                            <!-- 雷达波纹 (CSS 动画) -->
                            <div class="absolute w-48 h-48 bg-red-500/20 rounded-full animate-ping-slow"></div>
                            <div class="absolute w-32 h-32 bg-red-500/30 rounded-full animate-pulse"></div>
                            <!-- 中心实心点 -->
                            <div class="w-3 h-3 bg-[#ff4d4d] rounded-full shadow-[0_0_10px_#ff4d4d]"></div>
                            <!-- 标签 -->
                            <div
                                class="ml-4 bg-[#ff4d4d] text-black text-[10px] font-mono font-bold px-2 py-0.5 tracking-widest uppercase">
                                Hotspot
                            </div>
                        </div>

                        <!-- 3. 核心大标点：FIELD SPECIALIST (黄色角色) -->
                        <!-- 位置：偏右上 -->
                        <div class="absolute top-[35%] left-[65%] flex items-center z-10">
                            <!-- 中心点 -->
                            <div class="w-2 h-2 bg-[#ebfc72] rounded-full shadow-[0_0_8px_#ebfc72]"></div>
                            <!-- 连接线 -->
                            <div class="w-8 h-[1px] bg-[#ebfc72]/50"></div>
                            <!-- 标签 -->
                            <div
                                class="bg-[#ebfc72] text-[#13140e] text-[10px] font-mono font-bold px-2 py-0.5 tracking-widest uppercase shadow-lg">
                                Field Specialist
                            </div>
                        </div>

                        <!-- 4. 装饰性角落 (UI Elements) -->
                        <!-- 左上角 -->
                        <div class="absolute top-0 left-0 w-4 h-4 border-l border-t border-white/30"></div>
                        <!-- 右下角 -->
                        <div class="absolute bottom-0 right-0 w-4 h-4 border-r border-b border-white/30"></div>
                        <!-- 右侧刻度尺模拟 -->
                        <div
                            class="absolute right-0 top-1/2 -translate-y-1/2 h-32 w-1 border-r border-white/20 flex flex-col justify-between items-end pr-2">
                            <span class="w-2 h-[1px] bg-white/50"></span>
                            <span class="w-1 h-[1px] bg-white/20"></span>
                            <span class="w-1 h-[1px] bg-white/20"></span>
                            <span class="w-2 h-[1px] bg-white/50"></span>
                        </div>

                    </div>


                </div>
            </div>

            <!-- === UI 文字层 (Z=40) === -->
            <div class="slides-container absolute inset-0 z-40 pointer-events-none w-full h-full px-12">

                <!-- Text 1 -->
                <div id="text-1" class="absolute top-1/2 right-20 -translate-y-1/2 text-right max-w-lg">
                    <h3 class="text-[#ebfc72] text-xl tracking-widest mb-4">THE PROBLEM</h3>
                    <p class="text-[#f4f3e8] text-2xl font-light">Daytime view logic...</p>
                </div>

                <!-- Text 2 -->
                <div id="text-2"
                    class="absolute top-1/2 left-20 -translate-y-1/2 text-left max-w-lg opacity-0 translate-y-[50px]">
                    <h3 class="text-[#ebfc72] text-xl tracking-widest mb-4">ANALYSIS</h3>
                    <p class="text-[#f4f3e8] text-2xl font-light">Focusing on the ecosystem data...</p>
                </div>

                <!-- Text 3 -->
                <div id="text-3"
                    class="absolute top-1/2 right-20 -translate-y-1/2 text-right max-w-lg opacity-0 translate-y-[50px]">
                    <h3 class="text-[#ebfc72] text-xl tracking-widest mb-4">RESTORED</h3>
                    <p class="text-[#f4f3e8] text-2xl font-light">Back to the thriving day...</p>
                </div>

            </div>

        </div>
    </div>

    <!-- 3. 引入 JS 库 -->
    <!-- GSAP Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <!-- GSAP ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <!-- Lenis (Smooth Scroll) -->
    <script src="https://unpkg.com/lenis@1.1.20/dist/lenis.min.js"></script>

    <script>
        // ==========================================
        // 1. 配置与资源初始化
        // ==========================================
        const BASE_PATH = "svg"; 
      
        // 动态设置图片路径 (对应 HTML 中的 id)
        const images = {
          'img-day': 'hero-day.png',
          'img-night': 'hero-night.png',
          'img-rain': 'rain.png',
          'img-grid': 'grid.svg',
/*           'img-hotspots': 'hotspots.svg' */
        };
      
        for (const [id, filename] of Object.entries(images)) {
          const imgElement = document.getElementById(id);
          if (imgElement) {
            imgElement.src = `${BASE_PATH}/${filename}`;
          }
        }
      
        // 设置 Mask 遮罩路径
        const nightMaskLayer = document.getElementById('night-mask-layer');
        if (nightMaskLayer) {
          const maskUrl = `url("${BASE_PATH}/mask.svg")`;
          nightMaskLayer.style.maskImage = maskUrl;
          nightMaskLayer.style.webkitMaskImage = maskUrl;
        }
      
      
        // ==========================================
        // 2. 辅助函数：生成随机巡逻点 (GPS效果)
        // ==========================================
        
        /**
         * 创建随机巡逻点
         * @param {string} containerId - 容器 ID
         * @param {number} count - 生成数量
         */
        function createPatrolDots(containerId, count = 15) {
          const container = document.getElementById(containerId);
          if (!container) return;
      
          for (let i = 0; i < count; i++) {
            const dot = document.createElement('div');
            
            // 随机逻辑：30% 的概率是红色(敌对/异常)，70% 是黄色
            const isEnemy = Math.random() > 0.7; 
            dot.className = `patrol-dot ${isEnemy ? 'enemy' : ''}`;
            
            // 随机初始位置 (限制在 10% - 90% 区域内，防止贴边)
            const startX = gsap.utils.random(10, 90);
            const startY = gsap.utils.random(10, 90);
            
            dot.style.left = `${startX}%`;
            dot.style.top = `${startY}%`;
            
            container.appendChild(dot);
      
            // 启动游走动画
            animatePatrol(dot);
          }
        }
      
        /**
         * 递归动画：模拟布朗运动/人类行走
         */
        function animatePatrol(element) {
          gsap.to(element, {
            x: gsap.utils.random(-40, 40), // 在当前位置做随机位移
            y: gsap.utils.random(-40, 40),
            duration: gsap.utils.random(3, 6), // 随机时长，模拟不同移动速度
            ease: "sine.inOut", // 正弦缓动最自然
            onComplete: () => animatePatrol(element) // 动画结束后自我调用，无限循环
          });
        }
      
      
        // ==========================================
        // 3. Lenis 平滑滚动初始化
        // ==========================================
        const lenis = new Lenis();
      
        lenis.on('scroll', ScrollTrigger.update);
      
        gsap.ticker.add((time) => {
          lenis.raf(time * 1000);
        });
      
        gsap.ticker.lagSmoothing(0);
      
      
        // ==========================================
        // 4. 主动画逻辑 (ScrollTrigger)
        // ==========================================
        document.addEventListener("DOMContentLoaded", (event) => {
          
          gsap.registerPlugin(ScrollTrigger);
      
          // --- A. 初始化 DOM 引用 ---
          const container = document.getElementById('container');
          const wrapper = document.getElementById('wrapper');
          
          const dayLayer = document.getElementById('day-layer');
          const darkBgLayer = document.getElementById('dark-bg-layer');
          const nightMaskLayer = document.getElementById('night-mask-layer');
          
          const techLayer = document.getElementById('tech-layer');
          const gridContainer = document.getElementById('grid-container');
          const markersContainer = document.getElementById('markers-container'); // 新增的标点层
          const patrolDotsLayerId = 'patrol-dots-layer';
          
          const text1 = document.getElementById('text-1');
          const text2 = document.getElementById('text-2');
          const text3 = document.getElementById('text-3');
      
          // --- B. 生成巡逻点 ---
          createPatrolDots(patrolDotsLayerId, 25); // 生成 25 个点
      
          // --- C. 创建 Timeline ---
          const tl = gsap.timeline({
            scrollTrigger: {
              trigger: container,
              start: "top top",
              end: "bottom bottom",
              scrub: 0.5, // 滚动阻尼，0.5秒的跟手延迟，更顺滑
              pin: wrapper,
            }
          });
      
          // ==========================================
          // Phase 0: 初始状态设定 (Initial States)
          // ==========================================
          
          // Layer 1: 白天 (垫底，可见)
          tl.set(dayLayer, { zIndex: 0, autoAlpha: 1 });
      
          // 夹层: 深色背景 (初始隐藏)
          tl.set(darkBgLayer, { zIndex: 5, autoAlpha: 0 });
      
          // Layer 2: 黑夜 Mask (初始隐藏，Mask巨大)
          tl.set(nightMaskLayer, { 
            zIndex: 10,
            autoAlpha: 0, 
            webkitMaskSize: "300% 300%",
            maskSize: "300% 300%"
          });
      
          // Layer 3: Tech Grid & Markers (初始隐藏)
          tl.set(techLayer, { zIndex: 20 });
          // 网格和标点层都设为不可见
          tl.set([gridContainer, markersContainer], { autoAlpha: 0 });
      
          // 文字状态
          tl.set(text1, { autoAlpha: 1, y: 0 });
          tl.set([text2, text3], { autoAlpha: 0, y: 50 });
      
      
          // ==========================================
          // Phase 1: 准备与入场 (Day -> Night)
          // ==========================================
      
          // 1. 文字1 离场
          tl.to(text1, { y: -50, autoAlpha: 0, duration: 2 });
      
          // 2. 黑夜层淡入 (此时 Mask 还是 300%，铺满全屏)
          // 同时深色背景也淡入，防止后面缩小时漏底
          tl.to([darkBgLayer, nightMaskLayer], {
            autoAlpha: 1,
            duration: 4,
            ease: "power1.inOut"
          });
      
      
          // ==========================================
          // Phase 2: 聚焦与数据展示 (Focus & UI)
          // ==========================================
      
          // 1. Mask 缩小 (聚焦视野)
          tl.to(nightMaskLayer, {
            webkitMaskSize: "90% 90%",
            maskSize: "90% 90%",
            duration: 6,
            ease: "power2.inOut"
          });
      
          // 2. Grid 网格 + Markers 标点层 同时浮现
          // "<" 表示这个动画和上一个动画(Mask缩小)同时开始
          tl.to([gridContainer, markersContainer], {
            autoAlpha: 1,
            duration: 6,
            ease: "power2.inOut"
          }, "<"); 
      
          // 3. 文字2 (左侧 UI 介绍) 进场
          // "-=4" 表示提前 4秒开始，即在 Mask 缩小的后半段就开始出现
          tl.to(text2, { y: 0, autoAlpha: 1, duration: 2 }, "-=4");
      
          
          // ==========================================
          // Phase 3: 停留阅读 (Hold)
          // ==========================================
          // 这里的空动画是为了增加滚动的“厚度”，让用户有时间看文字和动画
          tl.to({}, { duration: 6 }); 
      
      
          // ==========================================
          // Phase 4: 退场与恢复 (Night -> Day)
          // ==========================================
          
          // 1. 文字2 离场
          tl.to(text2, { y: -50, autoAlpha: 0, duration: 2 });
      
          // 2. Mask 放大 (原路返回到 300%)
          tl.to(nightMaskLayer, {
            webkitMaskSize: "300% 300%",
            maskSize: "300% 300%",
            duration: 5,
            ease: "power2.inOut"
          });
      
          // 3. Grid 网格 + Markers 标点层 消失
          // "<" 表示与 Mask 放大同时发生
          tl.to([gridContainer, markersContainer], {
            autoAlpha: 0,
            duration: 4
          }, "<");
      
          // 4. 黑夜层 & 深色背景 淡出 (回到白天)
          tl.to([darkBgLayer, nightMaskLayer], {
            autoAlpha: 0,
            duration: 4,
            ease: "power1.inOut"
          });
      
          // 5. 文字3 (结果) 进场
          tl.to(text3, { y: 0, autoAlpha: 1, duration: 2 }, "-=2");
      
          // 结尾缓冲
          tl.to({}, { duration: 2 });
      
        });
      </script>
</body>

</html>
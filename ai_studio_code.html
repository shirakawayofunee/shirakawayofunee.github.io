<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000000" />
    <title>2人雰囲気 - THE VAULT</title>
    <meta property="og:type" content="website" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" />
    <link rel="stylesheet" href="css/papermask.css" media="(min-device-width:926px)">
    <link rel="stylesheet" href="css/papermaskDetail.css" media="(min-device-width:926px)" />
    <style>
        /* =========================================
           1. 字体与基础设置 (源自网页 A CSS)
           ========================================= */
        :root {
            --animate-duration: 800ms;
            --animate-delay: 0;
            --main-pink: #e23b78; /* 提取出的主色调 */
        }

        @font-face {
            font-family: "myFont";
            src: url("../font/DreamHanSansJP-W10.ttf") format("truetype");
            font-display: swap;
            /* 如果本地没有字体，提供一个备选方案，避免文字消失 */
            font-family: "myFont", "Roboto", "Helvetica Neue", sans-serif;
        }

        /* 修复冲突：网页B需要垂直滚动，而网页A原本是隐藏滚动的 */
        html, body {
            position: relative;
            min-height: 100%;
            font-family: 'myFont', sans-serif;
            background: #000; /* 全局黑色背景 */
            color: #ccc;
        }

        body {
            /* 允许垂直滚动，隐藏水平滚动 */
            overflow-y: auto; 
            overflow-x: hidden;
            margin: 0;
            padding: 0;
            /* 为固定的导航栏和二级菜单留出空间：Header(100px) + SubMenu(50px) + Padding */
            padding-top: 160px; 
            cursor: default; /* 恢复默认鼠标，除非你有自定义鼠标图片 */
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #06070d; 
        }
        ::-webkit-scrollbar-thumb {
            border-radius: 4px;
            background: #333; 
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--main-pink);
        }

        /* =========================================
           2. 顶部主导航栏 (源自网页 A CSS)
           ========================================= */
        .head {
            position: fixed; /* 改为 Fixed 固定在顶部 */
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.95); /* 增加不透明度 */
            border-bottom: 1px solid #1a1a1a;
            width: 100%;
            height: 6.25rem; /* 约 100px */
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem; /* 调整内边距 */
            box-sizing: border-box;
        }

        .h-con-left {
            width: auto;
            min-width: 150px;
        }

        .h-con-left h1 a {
            display: block;
            width: 100%;
            height: 100%;
            text-decoration: none;
            color: #fff; /* 临时 Logo 颜色 */
            font-size: 24px;
            font-weight: bold;
        }

        .h-con-right {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            height: 100%;
        }

        .h-con-right-l {
            display: flex;
            gap: 20px;
            margin-right: 40px;
        }

        .div-center {
            cursor: pointer;
            text-align: center;
            padding: 5px 10px;
            transition: all 0.3s ease;
        }

        .div-head-text {
            font-size: 1rem;
            color: #9ea7b4;
            font-family: 'myFont', sans-serif;
            transition: color 0.3s;
        }

        .div-head-text-en {
            font-size: 0.65rem;
            color: #555;
            letter-spacing: 0.1rem;
            text-transform: uppercase;
            font-family: 'Roboto', sans-serif;
            margin-top: 2px;
        }

        .div-center:hover .div-head-text {
            color: var(--main-pink);
        }
        .div-center:hover .div-head-text-en {
            color: var(--main-pink);
        }

        .h-con-right-r-con img {
            width: 24px;
            height: 24px;
            cursor: pointer;
            margin-left: 15px;
            filter: invert(1) brightness(2); /* 图标反白 */
            transition: transform 0.3s;
        }
        .h-con-right-r-con img:hover {
            transform: scale(1.1);
        }

        /* =========================================
           3. 二级菜单 (同级跳转指引) - 仿照上传图片排版
           ========================================= */
        .secondary-menu-container {
            position: fixed;
            top: 6.25rem; /* 紧接在主导航栏下方 */
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #000;
            z-index: 999;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center; /* 居中显示 */
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        /* 改造 Bootstrap Tabs */
        .gallery-header .nav-tabs {
            border-bottom: none;
            gap: 10px;
        }

        .gallery-header .nav-link {
            border: none;
            border-radius: 0;
            color: #666;
            font-family: 'myFont', monospace; /* 使用 monospace 更有机能感 */
            font-size: 0.9rem;
            padding: 10px 15px;
            background: transparent !important;
            transition: all 0.2s;
            position: relative;
            text-transform: uppercase;
        }

        .gallery-header .nav-link:hover {
            color: #fff;
        }

        .gallery-header .nav-link.active {
            color: #fff !important;
            font-weight: bold;
        }

        /* 选中时的下划线效果，类似图片中的选中状态 */
        .gallery-header .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--main-pink);
            box-shadow: 0 0 5px var(--main-pink);
        }

        /* =========================================
           4. 正文内容区 (原 Webpage B 样式适配)
           ========================================= */
        
        /* 悬浮文本框 */
        .floating-text {
            position: relative; /* 改为相对定位或固定在特定区域 */
            margin: 0 auto 30px auto;
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid #333;
            color: #aaa;
            padding: 20px;
            max-width: 1200px;
            width: 95%;
            border-left: 3px solid var(--main-pink); /* 左侧粉色条装饰 */
        }
        
        .floating-text span {
            font-size: 14px;
            line-height: 1.8;
        }

        .close-button {
            float: right;
            background: none;
            border: none;
            color: #666;
            font-size: 20px;
            cursor: pointer;
        }
        .close-button:hover { color: #fff; }

        /* 瀑布流容器 */
        .gallery-container {
            display: flex;
            gap: 15px;
            width: 100%;
            padding: 0 2%;
        }

        .gallery-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .gallery-item {
            position: relative;
            transition: transform 0.3s;
            background: #111;
        }

        .gallery-item:hover {
            transform: translateY(-2px);
            z-index: 10;
        }

        .gallery-item:hover .gallery-image {
            border: 1px solid var(--main-pink);
        }

        .gallery-image {
            width: 100%;
            height: auto;
            object-fit: cover;
            cursor: pointer;
            opacity: 0; /* 配合 lazy load */
            transition: opacity 0.5s, border 0.3s;
            display: block;
        }
        
        .gallery-image.loaded {
            opacity: 1;
        }

        .caption {
            font-size: 12px;
            color: #888;
            text-align: left;
            padding: 8px 5px;
            background: #000;
            width: 100%;
            border-top: 1px solid #222;
        }

        /* =========================================
           5. 响应式适配
           ========================================= */
        @media (max-width: 992px) {
            .gallery-container { display: grid; grid-template-columns: 1fr 1fr; }
            .h-con-right-l { display: none; } /* 移动端隐藏主菜单文字，可改为汉堡菜单 */
            .secondary-menu-container { overflow-x: auto; justify-content: flex-start; }
            .gallery-header .nav-tabs { flex-wrap: nowrap; }
        }

        @media (max-width: 576px) {
            .gallery-container { display: block; }
            .gallery-column { margin-bottom: 15px; }
            .head { padding: 0 10px; }
        }

        /* Modal 样式微调 */
        .image-modal .modal-content { background: transparent; border: none; }
        .papermaskDetailTop { background: rgba(0,0,0,0.8); }
        .papermaskDetailBottom { background: #222; border-top: 1px solid var(--main-pink); }
        .papermaskDetailBottom img { filter: invert(1); }
    </style>
</head>

<body>

    <!-- =============================================
         1. 复用网页 A 的导航栏
         ============================================= -->
    <div class="head pc" data-mouse="small">
      <div class="h-con-left">
        <h1 data-mouse="mid">
          <a href="index.html" style="cursor: pointer;" data-mouse="mid">
            <!-- 假设 Logo 文字，如果有图片 logo 请取消注释下方代码 -->
            MONOLENS
            <!-- <img src="img/logo.png" alt="logo" class="head-logo"> -->
          </a>
        </h1>
      </div>
      <div class="h-con-right pc" data-mouse="mid">
        <div class="h-con-right-l" data-mouse="mid">
          <div class="div-center" onclick="changeBanner(0)" id="banner0">
            <div class="div-head-text">序章ホーム</div>
            <div class="div-head-text-en">INDEX</div>
          </div>
          <div class="div-center" onclick="changeBanner(1)" id="banner1">
            <div class="div-head-text">登場人物</div>
            <div class="div-head-text-en">SETS</div>
          </div>
          <div class="div-center" onclick="changeBanner(2)" id="banner2">
            <div class="div-head-text">相関図</div>
            <div class="div-head-text-en">VAULT</div>
          </div>
          <div class="div-center" onclick="changeBanner(4)" id="banner4">
            <div class="div-head-text">世界観</div>
            <div class="div-head-text-en">GEAR</div>
          </div>
          <div class="div-center" onclick="changeBanner(5)" id="banner5">
            <div class="div-head-text">第一章</div>
            <div class="div-head-text-en">STORY</div>
          </div>
        </div>
        <div class="h-con-right-r">
          <div class="h-con-right-r-con">
            <div>
              <img src="img/v2.gif" alt="Play" onclick="muteMusic(1)" class="imgMusicPlay shareMusic" style="display: none;">
              <img src="img/v2c.png" alt="Stop" onclick="muteMusic(2)" class="imgMusicStop shareMusic">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- =============================================
         2. 同级页面跳转指引 (二级菜单)
         ============================================= -->
    <div class="secondary-menu-container">
        <div class="gallery-header">
            <ul class="nav nav-tabs" id="galleryTabs" role="tablist">
                <!-- 这里对应图片中的 "Rolls" 感觉 -->
                <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#gallery">イラスト</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#r18g">メインストーリー</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#lonly">L</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#sonly">S</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#dc">テーマ</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#doodle">落書き</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#manga">漫画</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#costume">衣装</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#catdw">ふわふわ</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#mansion">邸宅</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#travel">旅行</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#food">食べ物</a></li>
                <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#nsfw">NSFW</a></li>
            </ul>
        </div>
    </div>

    <!-- =============================================
         3. 页面主体内容
         ============================================= -->
    
    <!-- 悬浮说明文字 -->
    <div class="floating-text" id="floatingText">
        <button class="close-button" onclick="document.getElementById('floatingText').style.display='none'">×</button>
        <span>
            <strong>THE VAULT ARCHIVE:</strong><br>
            SLの関係についての私の考え：<br>
            二次創作における恋愛的な解釈については、私もすんなり受け入れます。純粋で美しい愛情を描くのも、不健全で歪んだ、
            さらには暗く湿った感情を表現するのも、どちらもすごく楽しんで鑑賞しています。
            <br>ただ、本家の設定においては、SLは単純な恋愛関係ではないが確かにそこに愛があることは間違いないです。
        </span>
    </div>

    <!-- 画廊区域 -->
    <div class="gallery-section container-fluid">
        <div class="tab-content" id="galleryTabContent">
            <!-- 各个标签页容器 -->
            <div class="tab-pane fade show active" id="gallery" role="tabpanel"><div class="gallery-container" id="galleryContainer"></div></div>
            <div class="tab-pane fade" id="r18g" role="tabpanel"><div class="gallery-container" id="r18gContainer"></div></div>
            <div class="tab-pane fade" id="lonly" role="tabpanel"><div class="gallery-container" id="lonlyContainer"></div></div>
            <div class="tab-pane fade" id="sonly" role="tabpanel"><div class="gallery-container" id="sonlyContainer"></div></div>
            <div class="tab-pane fade" id="dc" role="tabpanel"><div class="gallery-container" id="dcContainer"></div></div>
            <div class="tab-pane fade" id="doodle" role="tabpanel"><div class="gallery-container" id="doodleContainer"></div></div>
            <div class="tab-pane fade" id="manga" role="tabpanel"><div class="gallery-container" id="mangaContainer"></div></div>
            <div class="tab-pane fade" id="costume" role="tabpanel"><div class="gallery-container" id="costumeContainer"></div></div>
            <div class="tab-pane fade" id="death" role="tabpanel"><div class="gallery-container" id="deathContainer"></div></div>
            <div class="tab-pane fade" id="catdw" role="tabpanel"><div class="gallery-container" id="catdwContainer"></div></div>
            <div class="tab-pane fade" id="mansion" role="tabpanel"><div class="gallery-container" id="mansionContainer"></div></div>
            <div class="tab-pane fade" id="travel" role="tabpanel"><div class="gallery-container" id="travelContainer"></div></div>
            <div class="tab-pane fade" id="food" role="tabpanel"><div class="gallery-container" id="foodContainer"></div></div>
            <div class="tab-pane fade" id="nsfw" role="tabpanel"><div class="gallery-container" id="nsfwContainer"></div></div>
        </div>
    </div>

    <!-- 图片详情 Modal -->
    <div class="modal fade image-modal" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="papermaskDetailTop" data-mouse="small">
                <img src="#" alt="" data-mouse="small" class="papermaskDetailTop-zoom" id="papermaskDetailTop-zoom">
            </div>
            <div class="papermaskDetailBottom" data-mouse="mid">
                <img src="img/paperDetail/b.png" alt="放大" onclick="handleZoomChange(1)">
                <img src="img/paperDetail/s.png" alt="缩小" onclick="handleZoomChange(-1)">
                <img src="img/paperDetail/a.png" alt="重置" onclick="handleZoomChange(0)">
                <img src="img/paperDetail/d.png" alt="下载" onclick="handleDownload()">
            </div>
            <div class="papermaskDetailClose">
                <img src="img/paperDetail/c.png" alt="关闭" onclick="paperShowHide()">
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/papermaskDetail.js"></script>
    <script type="text/javascript">
        // 模拟 A 页面导航栏需要的函数
        function changeBanner(index) { console.log("Navigate to banner " + index); }
        function muteMusic(type) { console.log("Music toggle " + type); }

        // ================= 数据定义 (请保留原网页 B 中的所有数据数组) =================
        // 示例数据，请确保复制了完整的 const 定义
        const galleryImages = [
          { src: "img/SL/SL1.webp", alt: "Gallery Image 1", description: "「中秋の名月」" },
          { src: "img/SL/SL2.webp", alt: "Gallery Image 2", description: "「運命の舞台」" }
        ];
        
        // 占位空数组，防止未定义错误，请务必保留原有数据
        const r18gImages=[], dcImages=[], deathImages=[], mangaImages=[], mansionImages=[], 
              doodleImages=[], catdwImages=[], nsfwImages=[], travelImages=[], foodImages=[], 
              lonlyImages=[], sonlyImages=[], costumeImages=[];

        // ================= 瀑布流逻辑 =================
        function arrangeWaterfall(containerId, imageArray) {
            const container = document.getElementById(containerId);
            if(!container) return;
            container.innerHTML = "";

            const width = window.innerWidth;
            const columnCount = width > 992 ? 3 : width > 576 ? 2 : 1;

            const columns = Array(columnCount).fill().map(() => {
                const col = document.createElement("div");
                col.className = "gallery-column";
                container.appendChild(col);
                return col;
            });

            if(!imageArray) return;

            imageArray.forEach((image, index) => {
                const item = document.createElement("div");
                item.className = "gallery-item";

                const img = document.createElement("img");
                img.setAttribute("data-src", image.src);
                img.alt = image.alt;
                img.className = "img-fluid gallery-image lazy";
                img.setAttribute("data-bs-toggle", "modal");
                img.setAttribute("data-bs-target", "#imageModal");
                img.setAttribute("data-index", index);
                img.setAttribute("data-description", image.description);
                
                // 确定当前所属数组名
                let arrName = containerId.replace("Container", ""); 
                if(arrName === "gallery") arrName = "gallery"; 
                // 注意：这里需要根据 id 反推数组名，或者直接传递数组引用
                img.setAttribute("data-array-name", arrName);
                
                img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";

                const caption = document.createElement("div");
                caption.className = "caption";
                caption.textContent = image.description || "";

                item.appendChild(img);
                item.appendChild(caption);
                columns[index % columnCount].appendChild(item);

                img.addEventListener("click", handleImageClick);
            });

            lazyLoadImages();
        }

        function handleImageClick() {
            const src = this.getAttribute("data-src");
            const description = this.getAttribute("data-description");
            currentIndex = parseInt(this.getAttribute("data-index"));
            // 根据 data-array-name 获取实际数组
            const arrName = this.getAttribute("data-array-name");
            currentArrayName = arrName;

            const modalImage = document.getElementById("papermaskDetailTop-zoom");
            modalImage.src = src;
            
            if (typeof $ !== 'undefined') $(".papermaskDetailTop-zoom").css("transform", "scale(1)");
            else modalImage.style.transform = 'scale(1)';
            
            if(typeof window.papermaskZoom !== 'undefined') window.papermaskZoom = 1;
            if (typeof updatePapermaskDetail === 'function') updatePapermaskDetail(src, description || "");
        }

        function lazyLoadImages() {
            const images = document.querySelectorAll("img.lazy");
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach((entry) => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.getAttribute("data-src");
                        img.classList.remove("lazy");
                        img.classList.add("loaded");
                        observer.unobserve(img);
                    }
                });
            }, { rootMargin: "0px 0px 200px 0px", threshold: 0.01 });
            images.forEach((img) => observer.observe(img));
        }

        let currentIndex = 0;
        let currentArrayName = "gallery";

        // 辅助函数：根据名称获取数组对象
        function getArrayByName(name) {
             const map = {
                 "gallery": galleryImages, "r18g": r18gImages, "lonly": lonlyImages,
                 "sonly": sonlyImages, "dc": dcImages, "doodle": doodleImages,
                 "manga": mangaImages, "costume": costumeImages, "death": deathImages,
                 "catdw": catdwImages, "mansion": mansionImages, "travel": travelImages,
                 "food": foodImages, "nsfw": nsfwImages
             };
             return map[name] || [];
        }

        function papermaskDetailChange(direction) {
            const array = getArrayByName(currentArrayName);
            if (!array || array.length === 0) return;

            if (direction === 1) currentIndex = (currentIndex + 1) % array.length;
            else if (direction === -1) currentIndex = (currentIndex - 1 + array.length) % array.length;
            else currentIndex = 0;
            
            const item = array[currentIndex];
            const modalImage = document.getElementById("papermaskDetailTop-zoom");
            if (modalImage) {
                modalImage.src = item.src;
                modalImage.style.transform = 'scale(1)';
                if (typeof updatePapermaskDetail === 'function') updatePapermaskDetail(item.src, item.description || "");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // 初始化默认 Tab
            arrangeWaterfall("galleryContainer", galleryImages);
            
            // 监听 Tab 切换
            document.querySelectorAll(".nav-link").forEach((tab) => {
                tab.addEventListener("shown.bs.tab", () => {
                    const targetId = tab.getAttribute("href").substring(1); // e.g. "gallery"
                    const containerId = targetId + "Container";
                    const array = getArrayByName(targetId);
                    arrangeWaterfall(containerId, array);
                });
            });
        });
        
        document.addEventListener("keydown", function (event) {
            if (document.getElementById("imageModal").classList.contains("show")) {
                if (event.key === "ArrowLeft") papermaskDetailChange(-1);
                else if (event.key === "ArrowRight") papermaskDetailChange(1);
            }
        });
    </script>
</body>
</html>
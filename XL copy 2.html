<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="theme-color" content="#F8F7F8" />
<title>2人雰囲気 - XL</title>
<meta property="og:type" content="website" />
<link
href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
rel="stylesheet"
integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
crossorigin="anonymous"
/>
<link
href="https://fonts.googleapis.com/css?family=Roboto:400,700"
rel="stylesheet"
/>
<link rel="stylesheet" href="css/papermask.css" media="(min-device-width:926px)">
<link rel="stylesheet" href="css/papermaskDetail.css" media="(min-device-width:926px)" />
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Roboto", sans-serif;
  background: #06070d;
  color: #333;
  overflow-x: hidden;
}

/* 浮动div的样式 */
.floating-text {
  position: fixed; /* 固定定位，相对于浏览器窗口 */
  top: 2px; /* 距离顶部20像素 */
      left: 50%; /* 水平居中起始点 */
      transform: translateX(-50%); /* 向左偏移自身宽度的一半 */
  background-color: rgba(0, 0, 0, 0.7); /* 半透明黑色背景 */
  color: white; /* 文字颜色 */
  padding: 15px; /* 内边距 */
  border-radius: 5px; /* 圆角 */
  z-index: 1000; /* 确保在最上层 */
  max-width: 1920px; /* 最大宽度 */
  width: 100vw; /* 宽度与视口同宽 */
      box-sizing: border-box; /* 确保padding不增加总宽度 */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* 阴影效果 */
  text-align: left;
}

.close-button {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      padding: 0 10px;
  }

  .close-button:hover {
      color: #ccc; /* 鼠标悬停时变色 */
  }

.gallery-section {
  padding: 1%;
}

.gallery-header {
  /*             background: #fff; */
  padding: 30px 0 0 0;
}

.gallery-header .nav-tabs {
  background: #06070d;
  border-bottom: 2px solid #393d45;
}

.gallery-header .nav-link {
  font-size: 1.1em;
  /* 调整字体大小 */
  font-weight: 400;
  /* 正常字体粗细 */
  color: #ccc;
  padding: 5px 15px;
}

.gallery-header .nav-link.active {
  color: #000;
  border-bottom: 2px solid #000;
}

.gallery-container {
  display: flex;
  gap: 15px;
  width: 100%;
  background: #06070d;
}

.gallery-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.gallery-item {
  width: 100%;
  position: relative;
}

.gallery-image {
  width: 100%;
  height: auto;
  object-fit: cover;
  cursor: pointer;
}

.gallery-item :hover {
  border: 1px solid #ff005d;
}

.caption {
  font-size: 14px;
  color: #fff;
  text-align: center;
  padding: 8px 0;
  width: 100%;
  background: #06070d;
}

@media (max-width: 992px) {
  .gallery-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
}

@media (max-width: 576px) {
  .gallery-container {
    display: block;
  }

  .gallery-column {
    margin-bottom: 15px;
  }
}

.image-modal .modal-dialog {
  max-width: 100%;
    width: 100%;
    height: 100vh;
    margin: 0;
}

.image-modal .modal-content {
/*   background: #fff; */
  border-radius: 10px;
  overflow: hidden;
}

.image-modal .modal-body {
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

.image-modal .modal-image {
  max-height: 70vh;
  width: 100%;
  object-fit: contain;
}

.image-modal .description {
  padding: 20px;
  text-align: center;
  font-size: 1.1em;
  color: #666;
/*   background: #f8f8f8; */
  width: 100%;
}

.image-modal .modal-header {
  border-bottom: none;
}

.image-modal .btn-close {
  filter: invert(1);
}

@media (max-width: 576px) {
  .image-modal .modal-dialog {
    max-width: 100%;
    width: 100%;
    height: 100vh;
    margin: 0;
  }

  .image-modal .modal-image {
    max-height: 60vh;
  }

  .image-modal .description {
    font-size: 1em;
  }

  .papermaskDetailTop-zoom {
    max-height: 60vh;
  }
}

img.lazy {
  opacity: 0;
}

img.lazy[src] {
  opacity: 1;
}
.papermaskDetailTop {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  max-height: 90vh;
  overflow: hidden; /* 隐藏滚动条 */
}

.papermaskDetailTop-zoom {
  max-width: 100%;
  max-height: 80vh;
  object-fit: contain;
  transition: transform 0.3s ease;
}

.papermaskDetailBottom, .papermaskDetailClose {
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 10px;
/*   background: #f8f8f8; */
}

.papermaskDetailBottom img, .papermaskDetailClose img {
  cursor: pointer;  /* 确保按钮可点击 */
  pointer-events: auto;  /* 防止模态阻止事件 */
}
</style>
</head>

<body>
<div class="gallery-section mt-5">
<div class="gallery-header mb-3">
  <ul class="nav nav-tabs" id="galleryTabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="gallery-tab" data-bs-toggle="tab" href="#gallery" role="tab"
        aria-controls="gallery" aria-selected="true">【公式】メインストーリー/本編</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="dc-tab" data-bs-toggle="tab" href="#dc" role="tab" aria-controls="dc"
        aria-selected="false">イラスト</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="manga-tab" data-bs-toggle="tab" href="#manga" role="tab" aria-controls="manga"
        aria-selected="false">○○しないと出られない部屋</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="catdw-tab" data-bs-toggle="tab" href="#catdw" role="tab" aria-controls="catdw"
        aria-selected="false">ふわふわ（擬獣化SD）</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="theme-tab" data-bs-toggle="tab" href="#theme" role="tab" aria-controls="theme"
        aria-selected="false">テーマ</a>
    </li>
  </ul>
</div>
<div class="tab-content" id="galleryTabContent">
  <div class="tab-pane fade show active" id="gallery" role="tabpanel" aria-labelledby="gallery-tab">
    <div class="gallery-container" id="galleryContainer"></div>
  </div>
  <div class="tab-pane fade" id="dc" role="tabpanel" aria-labelledby="dc-tab">
    <div class="gallery-container" id="dcContainer"></div>
  </div>
  <div class="tab-pane fade" id="death" role="tabpanel" aria-labelledby="death-tab">
    <div class="gallery-container" id="deathContainer"></div>
  </div>
  <div class="tab-pane fade" id="manga" role="tabpanel" aria-labelledby="manga-tab">
    <div class="gallery-container" id="mangaContainer"></div>
  </div>
  <div class="tab-pane fade" id="mansion" role="tabpanel" aria-labelledby="mansion-tab">
    <div class="gallery-container" id="mansionContainer"></div>
  </div>
  <div class="tab-pane fade" id="doodle" role="tabpanel" aria-labelledby="doodle-tab">
    <div class="gallery-container" id="doodleContainer"></div>
  </div>
  <div class="tab-pane fade" id="catdw" role="tabpanel" aria-labelledby="catdw-tab">
    <div class="gallery-container" id="catdwContainer"></div>
  </div>
  <div class="tab-pane fade" id="nsfw" role="tabpanel" aria-labelledby="nsfw-tab">
    <div class="gallery-container" id="nsfwContainer"></div>
  </div>
  <div class="tab-pane fade" id="r18g" role="tabpanel" aria-labelledby="r18g-tab">
    <div class="gallery-container" id="r18gContainer"></div>
  </div>
  <div class="tab-pane fade" id="theme" role="tabpanel" aria-labelledby="theme-tab">
    <div class="gallery-container" id="themeContainer"></div>
  </div>
</div>
</div>

<div class="modal fade image-modal" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered">
    <div class="papermaskDetailTop" data-mouse="small">
      <img src="#" alt="" data-mouse="small" class="papermaskDetailTop-zoom" id="papermaskDetailTop-zoom">
    </div>

    <div class="papermaskDetailBottom" data-mouse="mid">
      <img src="img/paperDetail/b.png" alt="放大" onclick="handleZoomChange(1)">
      <img src="img/paperDetail/s.png" alt="缩小" onclick="handleZoomChange(-1)">
      <img src="img/paperDetail/a.png" alt="重置" onclick="handleZoomChange(0)">
      <img src="img/paperDetail/d.png" alt="下载" onclick="handleDownload()">
    </div>
    <div class="papermaskDetailClose">
      <img src="img/paperDetail/c.png" alt="" onclick="paperShowHide()">
    </div>
</div>
</div>
<script src="js/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="js/papermaskDetail.js"></script>
<script type="text/javascript">
  var gk_isXlsx = false;
  var gk_xlsxFileLookup = {};
  var gk_fileData = {};
  function filledCell(cell) {
    return cell !== '' && cell != null;
  }
  function loadFileData(filename) {
  if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
      try {
          var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
          var firstSheetName = workbook.SheetNames[0];
          var worksheet = workbook.Sheets[firstSheetName];
          var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
          var filteredData = jsonData.filter(row => row.some(filledCell));
          var headerRowIndex = filteredData.findIndex((row, index) =>
            row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
          );
          // Fallback
          if (headerRowIndex === -1 || headerRowIndex > 25) {
            headerRowIndex = 0;
          }

          // Convert filtered JSON back to CSV
          var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
          csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
          return csv;
      } catch (e) {
          console.error(e);
          return "";
      }
  }
  return gk_fileData[filename] || "";
  }

const galleryImages = [
/* {
    src: "img/XL/zhuxian0.webp",alt: "Gallery Image 0",description: "メインストーリー/本編",
  }, */
  {
    src: "img/XL/zhuxian1.jpg",alt: "【公式】メインストーリー",description: "【猫猫バージョン】Lの過去 P1-P6",
  },
  {
    src: "img/XL/zhuxian2.webp",alt: "メインストーリー",description: "【メインストーリー/本編】「瞳に映るキミ」",
  },
  { src: "img/L/L-1.jpg", alt: "メインストーリー/本編", description: "【メインストーリー/本編】Lの過去 P1-P7" },
  {
    src: "img/XL/zhuxian3.jpg",alt: "メインストーリー",description: "【メインストーリー/本編】（猫猫バージョン）",
  },
  {
    src: "img/XL/zhuxian4.webp",alt: "メインストーリー",description: "【メインストーリー/本編】FIN",
  },
  {
    src: "img/XL/zhuxian5.jpg",alt: "メインストーリー",description: "【メインストーリー/本編】「後日談」",
  },
  {src: "img/XL/Xliwu.webp",alt: "メインストーリー",description: "【BAD END-IF】Xからのご挨拶――Lの中で一番重い存在、その死骸",},
  {src: "img/XL/Xliwu2.webp",alt: "メインストーリー",description: "【BAD END-IF】",},
  { src: "img/XL/X表情.jpg", alt: "X表情", description: "X表情" },
  { src: "img/XL/工事中.jpg", alt: "工事中", description: "" },
];

const dcImages = [
{ src: "img/XL/00.jpg", alt: "Gallery Image 5", description: "" },
{
    src: "img/XL/XL0.jpg",
    alt: "Gallery Image 1",
    description: "",
  },
  {
    src: "img/XL/XL1.jpg",
    alt: "Gallery Image 1",
    description: "",
  },
  {
    src: "img/XL/XL2.jpg",
    alt: "Gallery Image 2",
    description: "死の舞踏",
  },
  {src: "img/XL/XL3.jpg",alt: "Gallery Image 3",description: "手繋ぐ"},
  {src: "img/XL/XL4.jpg",alt: "Gallery Image 4",description: "首を絞める"},
  { src: "img/XL/XL5.jpg", alt: "Gallery Image 5", description: "" },
  { src: "img/XL/XL6.jpg", alt: "Gallery Image 6", description: "" },
  { src: "img/XL/XL7.jpg", alt: "Gallery Image 7", description: "共同の出発点（反逆）" },
  { src: "img/XL/XL8.jpg", alt: "Gallery Image 8", description: "" },
  { src: "img/XL/XL9.jpg", alt: "Gallery Image 8", description: "" },
{ src: "img/XL/IF1.webp", alt: "DC Image 1", description: "禁断の果実をこっそり味わう牧師と悪魔" },
  { src: "img/XL/IF2.webp", alt: "DC Image 2", description: "牧師と悪魔AU" },
  { src: "img/XL/IF3.jpg", alt: "DC Image 3", description: "" },
  { src: "img/XL/IF4.jpg", alt: "DC Image 4", description: "" },
  { src: "img/XL/IF5.jpg", alt: "DC Image 5", description: "" },
  { src: "img/XL/掐脖子2.jpg", alt: "Gallery Image 8", description: "首を絞める" },
  { src: "img/XL/IF6.jpg", alt: "DC Image 6", description: "" },
  { src: "img/XL/IF7.jpg", alt: "DC Image 7", description: "【SD】" },
  { src: "img/XL/Halloween.jpg", alt: "Halloween", description: "【SD】Halloween！" },
  { src: "img/XL/可爱.jpg", alt: "Halloween", description: "【SD】DEATH NOTE（？" },
/*   { src: "img/XL/IF8.jpg", alt: "DC Image 8", description: "" },
  { src: "img/XL/IF9.jpg", alt: "DC Image 9", description: "" }, */
];

const mangaImages = [
/*   { src: "img/XL/MH/1.jpg", alt: "Manga Image 1", description: "「○○しないと出られない部屋」①" },
  { src: "img/XL/MH/2.jpg", alt: "Manga Image 2", description: "「○○しないと出られない部屋」②" },
  { src: "img/XL/MH/3.jpg", alt: "Manga Image 3", description: "「○○しないと出られない部屋」③" }, */
  { src: "img/XL/MH/4.png", alt: "Manga Image 4", description: "「○○しないと出られない部屋」p4" },
];

const catdwImages = [
  { src: "img/XL/cat/dw1.jpg", alt: "Catdw Image 1", description: "気持ち悪がる猫とあざとウサギ" },
  { src: "img/XL/cat/dw2.jpg", alt: "Catdw Image 2", description: "猫の群れでは、地位の高い猫が低い猫の毛づくろぎますが、ウサギの群れでは、毛づくろいされることがより高い地位を象徴している。なので、二人とも自分が上だと思っているのです！" },
  { src: "img/XL/cat/心满意足.jpg", alt: "Catdw Image 3", description: "" },
];

const r18gImages = [
  { src: "img/XL/g1.jpg", alt: "R18-G Image 1", description: "" },
  { src: "img/XL/g2.jpg", alt: "R18-G Image 2", description: "" },
];

const themeImages = [
{ src: "img/DC/ThrillMe/ThrillMe-1.jpg", alt: "DC Image 5", description: "ミュージカル『Thrill Me』" },
{ src: "img/DC/ThrillMe/ThrillMe-2.jpg", alt: "DC Image 5", description: "ミュージカル『Thrill Me』" },
{ src: "img/DC/ThrillMe/ThrillMe-3.jpg", alt: "DC Image 5", description: "ミュージカル『Thrill Me』" },
{ src: "img/DC/ThrillMe/ThrillMe-4.jpg", alt: "DC Image 5", description: "ミュージカル『Thrill Me』" },
{ src: "img/DC/ThrillMe/ThrillMe-5.jpg", alt: "DC Image 5", description: "ミュージカル『Thrill Me』" },
];

const deathImages = [];
const mansionImages = [];
const doodleImages = [];
const nsfwImages = [];

  // 定义 updatePapermaskDetail（如果需要）
  function updatePapermaskDetail(src, desc) {
    console.log(desc); // 或更新DOM显示描述
  }

function arrangeWaterfall(containerId, imageArray) {
  const container = document.getElementById(containerId);
  container.innerHTML = "";

  const width = window.innerWidth;
  const columnCount = width > 992 ? 3 : width > 576 ? 2 : 1;

  const columns = Array(columnCount)
    .fill()
    .map(() => {
      const col = document.createElement("div");
      col.className = "gallery-column";
      container.appendChild(col);
      return col;
    });

  imageArray.forEach((image, index) => {
    const item = document.createElement("div");
    item.className = "gallery-item";

    const img = document.createElement("img");
    img.setAttribute("data-src", image.src);
    img.alt = image.alt;
    img.className = "img-fluid gallery-image lazy";
    img.setAttribute("data-bs-toggle", "modal");
    img.setAttribute("data-bs-target", "#imageModal");
    img.setAttribute("data-index", index);
    img.setAttribute("data-description", image.description);
    img.setAttribute(
      "data-array",
      containerId === "galleryContainer"
        ? "gallery"
        : containerId === "dcContainer"
        ? "dc"
        : containerId === "deathContainer"
        ? "death"
        : containerId === "mangaContainer"
        ? "manga"
        : containerId === "mansionContainer"
        ? "mansion"
        : containerId === "doodleContainer"
        ? "doodle"
        : containerId === "catdwContainer"
        ? "catdw"
        : containerId === "nsfwContainer"
        ? "nsfw"
        : containerId === "r18gContainer"
        ? "r18g"
        : containerId === "themeContainer"
        ? "theme"
        : ""
    );
    img.src =
      "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";

    const caption = document.createElement("div");
    caption.className = "caption";
    caption.textContent = image.description || "";

    item.appendChild(img);
    item.appendChild(caption);
    columns[index % columnCount].appendChild(item);

    img.removeEventListener("click", handleImageClick);
    img.addEventListener("click", handleImageClick);
  });

  lazyLoadImages();
}

function handleImageClick() {
    const src = this.getAttribute("data-src");
    const description = this.getAttribute("data-description");
    currentIndex = parseInt(this.getAttribute("data-index"));
    currentArray = this.getAttribute("data-array");
    const modalImage = document.getElementById("papermaskDetailTop-zoom");
    modalImage.src = src;
    // 重置缩放（jQuery版）
    $(".papermaskDetailTop-zoom").css("transform", "scale(1)");
    if (typeof updatePapermaskDetail === 'function') {
      updatePapermaskDetail(src, description || "暂无说明");
    }
  }

// 单个 initializeTabs（合并）
function initializeTabs() {
    arrangeWaterfall("galleryContainer", galleryImages);
    arrangeWaterfall("dcContainer", dcImages);
    arrangeWaterfall("mangaContainer", mangaImages);
    arrangeWaterfall("catdwContainer", catdwImages);
    arrangeWaterfall("r18gContainer", r18gImages);
    arrangeWaterfall("themeContainer", themeImages);
    // 其他为空数组，不会报错
  }

function lazyLoadImages() {
  const images = document.querySelectorAll("img.lazy");
  const observer = new IntersectionObserver(
    (entries, observer) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.getAttribute("data-src");
          img.classList.remove("lazy");
          observer.unobserve(img);
        }
      });
    },
    {
      rootMargin: "0px 0px 100px 0px",
      threshold: 0.1,
    }
  );

  images.forEach((img) => observer.observe(img));
}

document.addEventListener("DOMContentLoaded", () => {
  initializeTabs();
  
  // 添加鼠标悬停和点击事件以切换选项卡
  document.querySelectorAll(".nav-link").forEach((tab) => {
    // 鼠标悬停事件
    tab.addEventListener("mouseover", () => {
      // 确保不重复触发当前激活的选项卡
      if (!tab.classList.contains("active")) {
        const tabInstance = new bootstrap.Tab(tab);
        tabInstance.show();
      }
    });

    // 点击切换事件
    tab.addEventListener("shown.bs.tab", () => {
      const target = tab.getAttribute("href").substring(1);
      if (target === "gallery")
        arrangeWaterfall("galleryContainer", galleryImages);
      else if (target === "dc")
        arrangeWaterfall("dcContainer", dcImages);
      else if (target === "manga")
        arrangeWaterfall("mangaContainer", mangaImages);
      else if (target === "catdw")
        arrangeWaterfall("catdwContainer", catdwImages);
      else if (target === "r18g")
        arrangeWaterfall("r18gContainer", r18gImages);
      else if (target === "theme")
        arrangeWaterfall("themeContainer", themeImages);
    });
  });
});

let currentIndex = 0;
let currentArray = "gallery";

function papermaskDetailChange(direction) {
  const array =
    currentArray === "gallery"
      ? galleryImages
      : currentArray === "dc"
      ? dcImages
      : currentArray === "death"
      ? deathImages
      : currentArray === "manga"
      ? mangaImages
      : currentArray === "mansion"
      ? mansionImages
      : currentArray === "doodle"
      ? doodleImages
      : currentArray === "catdw"
      ? catdwImages
      : currentArray === "nsfw"
      ? nsfwImages
      : currentArray === "r18g"
      ? r18gImages
      : currentArray === "theme"
      ? themeImages
      : [];
  if (direction === 1) {
    currentIndex = (currentIndex + 1) % array.length;
  } else if (direction === -1) {
    currentIndex = (currentIndex - 1 + array.length) % array.length;
  } else if (direction === 0) {
    currentIndex = 0;
  }
  const modalImage = document.getElementById("papermaskDetailTop-zoom");
  modalImage.src = array[currentIndex].src;
  if (typeof updatePapermaskDetail === 'function') {
    updatePapermaskDetail(array[currentIndex].src, array[currentIndex].description || "暂无说明");
  }
}

function papermaskDetailDown() {
  const modal = bootstrap.Modal.getInstance(document.getElementById("imageModal"));
  if (modal) {
    modal.hide();
  }
}

function paperShowHide() {
  const modal = bootstrap.Modal.getInstance(document.getElementById("imageModal"));
  if (modal) {
    modal.hide();
  }
}

document.addEventListener("keydown", function (event) {
  if (document.getElementById("imageModal").classList.contains("show")) {
    if (event.key === "ArrowLeft") {
      papermaskDetailChange(-1);
    } else if (event.key === "ArrowRight") {
      papermaskDetailChange(1);
    }
  }
});
</script>
</body>
</html>
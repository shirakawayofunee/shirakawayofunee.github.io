<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>交互式剧情流程图</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #e8ecef;
            font-family: Arial, sans-serif;
            color: #333;
            overflow-x: auto;
        }
        .container {
            text-align: center;
            padding: 20px;
        }
        #flowchart {
            margin: 20px auto;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMUQ5Q0I0OTFBNDRBMTFFMDk5RDNENjg0MkYxNDcwQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMUQ5Q0I0OTJBNDRBMTFFMDk5RDNENjg0MkYxNDcwQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjpJbnN0YW5jZUlEPSJ4bXAuaWlkOkIxRDlDQjQ3OUE0NEExMUUwOTlEM0Q2ODQyRjE0NzBDIiBzdFJlZjpsZG0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpCMUQ5Q0I0OTFBNDRBMTFFMDk5RDNENjg0MkYxNDcwQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpCMUQ5Q0I0OTJBNDRBMTFFMDk5RDNENjg0MkYxNDcwQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjpJbnN0YW5jZUlEPSJ4bXAuaWlkOkIxRDlDQjQ3OUE0NEExMUUwOTlEM0Q2ODQyRjE0NzBDIiBzdFJlZjpsZG9jdW1lbnRJRD0ieG1wLmRpZDpCMUQ5Q0I0ODlBNDRBMTFFMDk5RDNENjg0MkYxNDcwQyIvPiA8L3JkZjpEZXNjcmlwdGlvbi>') repeat;
            width: 1200px;
            height: 400px;
        }
        .node {
            cursor: pointer;
            fill: #007bff;
            stroke: #0056b3;
            stroke-width: 2;
        }
        .node.active {
            fill: #28a745;
            stroke: #218838;
        }
        .path {
            stroke: #007bff;
            stroke-width: 2;
            fill: none;
        }
        .path.active {
            stroke: #28a745;
        }
        .description-box {
            background-color: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-reset {
            margin-top: 10px;
        }
        text {
            font-size: 12px;
            fill: #fff;
            text-anchor: middle;
            dominant-baseline: middle;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">交互式剧情流程图</h1>
        <svg id="flowchart"></svg>
        <div id="description" class="description-box"></div>
        <button class="btn btn-secondary btn-reset" onclick="resetFlowchart()">重置流程</button>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js"></script>
    <script>
        const s = Snap("#flowchart");
        let currentNode = null;

        // 剧情数据结构（水平布局，模仿《底特律：变人》）
        const story = {
            start: {
                id: "start",
                x: 100, y: 100,
                description: "你醒来发现自己身处一片森林，雾气弥漫。你听到远处传来奇怪的声音。你会：",
                choices: [
                    { text: "走向声音", next: "node1" },
                    { text: "远离声音", next: "node2" }
                ]
            },
            node1: {
                id: "node1",
                x: 250, y: 100,
                description: "你走向声音，发现一个受伤的旅人。他请求你的帮助。你会：",
                choices: [
                    { text: "帮助他", next: "node1-1" },
                    { text: "离开他", next: "node1-2" }
                ]
            },
            "node1-1": {
                id: "node1-1",
                x: 400, y: 50,
                description: "你帮助了旅人，他感激地给了你一张地图。结局：你找到回家的路。",
                choices: []
            },
            "node1-2": {
                id: "node1-2",
                x: 400, y: 150,
                description: "你选择离开，雾气越来越浓，你迷失了方向。结局：迷失在森林中。",
                choices: []
            },
            node2: {
                id: "node2",
                x: 250, y: 200,
                description: "你远离声音，走到了一个废弃的小屋。你会：",
                choices: [
                    { text: "进入小屋", next: "node2-1" },
                    { text: "继续走", next: "node2-2" }
                ]
            },
            "node2-1": {
                id: "node2-1",
                x: 400, y: 250,
                description: "你进入小屋，发现一本日记，揭示了森林的秘密。结局：你成为探险家。",
                choices: []
            },
            "node2-2": {
                id: "node2-2",
                x: 400, y: 350,
                description: "你继续前行，掉进一个陷阱。结局：被困森林深处。",
                choices: []
            }
        };

        // 绘制流程图
        function drawFlowchart() {
            s.clear();

            // 绘制节点和路径
            for (let nodeId in story) {
                const node = story[nodeId];
                const rect = s.rect(node.x - 50, node.y - 20, 100, 40, 5).attr({ class: "node" });
                rect.data("id", nodeId);
                s.text(node.x, node.y, nodeId).attr({ class: "node-label" });

                // 绘制连接线
                node.choices.forEach((choice, index) => {
                    const nextNode = story[choice.next];
                    const path = s.path(`M${node.x},${node.y + 20} L${nextNode.x},${nextNode.y - 20}`).attr({ class: "path" });
                    // 添加选择点
                    s.circle(node.x, node.y + 20, 5).attr({ fill: "#007bff", class: "choice-point" });
                });

                // 点击事件
                rect.click(function() {
                    selectNode(nodeId);
                });
            }
        }

        // 选择节点并更新显示
        function selectNode(nodeId) {
            currentNode = nodeId;
            const node = story[nodeId];

            // 高亮当前节点和路径
            s.selectAll(".node").forEach(n => n.removeClass("active"));
            s.selectAll(".path").forEach(p => p.removeClass("active"));
            s.selectAll(".choice-point").forEach(p => p.attr({ fill: "#007bff" }));
            s.select(`.node[data-id="${nodeId}"]`).addClass("active");

            // 高亮路径（从当前节点回溯）
            let current = nodeId;
            while (current !== "start") {
                for (let parentId in story) {
                    const parent = story[parentId];
                    if (parent.choices.some(choice => choice.next === current)) {
                        const path = s.select(`path[d="M${parent.x},${parent.y + 20} L${story[current].x},${story[current].y - 20}"]`);
                        if (path) path.addClass("active");
                        const point = s.select(`circle:nth-child(${parent.choices.findIndex(c => c.next === current) + 1}) + circle`, s.select(`.node[data-id="${parentId}"]`));
                        if (point) point.attr({ fill: "#28a745" });
                        current = parentId;
                        break;
                    }
                }
            }

            // 更新描述
            let descriptionHtml = `<p>${node.description}</p>`;
            if (node.choices.length > 0) {
                descriptionHtml += '<div>';
                node.choices.forEach(choice => {
                    descriptionHtml += `<button class="btn btn-primary mx-1" onclick="selectNode('${choice.next}')">${choice.text}</button>`;
                });
                descriptionHtml += '</div>';
            }
            document.getElementById("description").innerHTML = descriptionHtml;
        }

        // 重置流程图
        function resetFlowchart() {
            selectNode("start");
        }

        // 初始化
        drawFlowchart();
        resetFlowchart();
    </script>
</body>
</html>